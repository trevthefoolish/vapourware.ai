<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ecclesiastes 1:1-4</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css">
  <style>
    :root {
      --gold: #daa520;
      --gold-lit: #f0d060;
      --cream: #f5f2eb;
      --cream-dim: rgba(245, 242, 235, 0.68);
      --bg: #0a0a0a;
      --font-title-en: clamp(24px, 4vw, 48px);
      --font-title-he: clamp(50px, 10vw, 120px);
      --font-word-he: clamp(30px, 5.5vw, 56px);
      --font-word-en: clamp(20px, 3vw, 36px);
      --word-padding: 0.2em 0.35em;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      background: var(--bg);
      overflow: hidden;
      font-family: 'Cormorant Garamond', serif;
    }

    /* Swiper container */
    .swiper {
      width: 100%;
      height: 100%;
    }

    .swiper-slide {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Progress bar (Swiper handles updates) */
    .swiper-pagination-progressbar {
      background: transparent !important;
      bottom: env(safe-area-inset-bottom, 0) !important;
      top: auto !important;
      height: clamp(3px, 0.4vw, 5px) !important;
    }

    .swiper-pagination-progressbar-fill {
      background: linear-gradient(90deg, rgba(218, 165, 32, 0.7), rgba(240, 208, 96, 0.85)) !important;
      box-shadow: 0 0 12px rgba(218, 165, 32, 0.4);
    }

    /* ===== TITLES ===== */
    .title-en {
      font-size: var(--font-title-en);
      font-weight: 300;
      color: var(--cream);
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    .title-he {
      position: fixed;
      font-size: var(--font-title-he);
      font-weight: 400;
      color: var(--gold);
      direction: rtl;
      z-index: 100;
      padding: var(--word-padding);
      cursor: pointer;
      -webkit-user-select: none;
      user-select: none;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
    }

    /* ===== VERSES ===== */
    .verse {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: min(90vw, 900px);
    }

    .verse-he {
      direction: rtl;
      text-align: center;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: baseline;
      gap: 0.3em 0.45em;
      line-height: 1.6;
    }

    .verse-en {
      font-size: var(--font-word-en);
      font-weight: 400;
      font-style: italic;
      line-height: 2.2;
      margin-top: 1.1em;
      text-align: center;
      color: var(--cream-dim);
      letter-spacing: 0.03em;
    }

    /* ===== WORDS ===== */
    .word-he {
      font-size: var(--font-word-he);
      font-weight: 400;
      color: var(--gold);
      padding: var(--word-padding);
      cursor: pointer;
      transition: color 0.25s ease, text-shadow 0.25s ease;
      -webkit-user-select: none;
      user-select: none;
    }

    .word-en {
      color: var(--cream-dim);
      padding: 0.1em 0.15em;
      cursor: pointer;
      transition: color 0.25s ease, text-shadow 0.25s ease;
      -webkit-user-select: none;
      user-select: none;
    }

    .placeholder {
      font-size: var(--font-word-he);
      font-weight: 400;
      color: transparent;
      padding: var(--word-padding);
    }

    /* ===== HIGHLIGHTING ===== */
    [data-tippy-content].lit {
      --glow: 0 0 20px rgba(218, 165, 32, 0.6);
      color: var(--gold-lit);
      text-shadow: var(--glow);
      animation: glowPulse 2.5s ease-in-out infinite;
    }

    .word-en.lit {
      --glow: 0 0 15px rgba(255, 255, 255, 0.5);
      color: #fff;
    }

    .title-he.lit {
      --glow: 0 0 25px rgba(218, 165, 32, 0.6);
    }

    @keyframes glowPulse {
      0%, 100% { text-shadow: var(--glow); filter: brightness(1); }
      50% { text-shadow: var(--glow), var(--glow); filter: brightness(1.1); }
    }

    /* ===== TIPPY THEME ===== */
    .tippy-box[data-theme~='ecclesiastes'] {
      background: rgba(10, 8, 6, 0.85);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid rgba(218, 165, 32, 0.25);
      border-radius: clamp(12px, 1.5vw, 16px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 80px rgba(218, 165, 32, 0.08);
      max-width: min(400px, 85vw) !important;
      padding: clamp(16px, 2vw, 24px) clamp(20px, 2.5vw, 32px);
    }

    .tippy-box[data-theme~='ecclesiastes'] .tippy-arrow { display: none; }

    .tooltip-hebrew {
      font-size: clamp(22px, 4vw, 34px);
      color: var(--gold);
      direction: rtl;
      text-align: center;
      margin-bottom: clamp(6px, 1vw, 10px);
      font-weight: 500;
      text-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
    }

    .tooltip-translit {
      font-size: clamp(14px, 2.5vw, 20px);
      color: var(--cream);
      text-align: center;
      font-style: italic;
      letter-spacing: 0.05em;
      margin-bottom: clamp(10px, 1.5vw, 14px);
      padding-bottom: clamp(10px, 1.5vw, 14px);
      border-bottom: 1px solid rgba(218, 165, 32, 0.25);
    }

    .tooltip-tidbit {
      font-size: clamp(13px, 2vw, 18px);
      color: rgba(232, 228, 220, 0.85);
      line-height: 1.6;
      font-weight: 300;
    }

    /* ===== VERSE SELECTOR ===== */
    .verse-nav {
      position: fixed;
      top: clamp(20px, 3vw, 40px);
      right: clamp(20px, 3vw, 40px);
      display: flex;
      gap: 8px;
      font-size: clamp(14px, 2vw, 22px);
      color: rgba(245, 242, 235, 0.5);
      z-index: 50;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .verse-nav.visible { opacity: 1; }

    .verse-nav span {
      cursor: pointer;
      padding: 8px 10px;
      border-radius: 6px;
      transition: color 0.15s, background 0.15s;
    }

    .verse-nav span:hover {
      background: rgba(218, 165, 32, 0.15);
      color: var(--cream);
    }

    .verse-nav span.active { color: var(--gold); }

    /* ===== HINTS ===== */
    .scroll-hint {
      position: fixed;
      bottom: calc(28px + env(safe-area-inset-bottom, 0px));
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      opacity: 0;
      animation: fadeIn 1.5s ease 2s forwards;
      pointer-events: none;
      z-index: 50;
    }

    .scroll-hint-text {
      font-size: clamp(12px, 1.5vw, 16px);
      color: rgba(245, 242, 235, 0.5);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      font-weight: 300;
    }

    .scroll-hint-chevron {
      width: clamp(20px, 2.5vw, 28px);
      height: clamp(20px, 2.5vw, 28px);
      border-right: 2px solid rgba(218, 165, 32, 0.5);
      border-bottom: 2px solid rgba(218, 165, 32, 0.5);
      transform: rotate(45deg);
      animation: bounce 1.5s ease-in-out infinite;
    }

    @keyframes fadeIn { to { opacity: 1; } }
    @keyframes bounce {
      0%, 100% { transform: rotate(45deg) translateY(0); }
      50% { transform: rotate(45deg) translateY(4px); }
    }
  </style>
</head>
<body>
  <div class="swiper">
    <div class="swiper-wrapper">
      <!-- Slide 0: Title only -->
      <div class="swiper-slide">
        <div class="title-en">Ecclesiastes</div>
      </div>

      <!-- Slide 1: Title + Qohelet (handled by choreography) -->
      <div class="swiper-slide">
        <div class="title-en" style="transform: translateY(-50px)">Ecclesiastes</div>
      </div>

      <!-- Slide 2: Qohelet alone (choreography centers it) -->
      <div class="swiper-slide"></div>

      <!-- Slide 3: Verse 1 -->
      <div class="swiper-slide" data-verse="1">
        <div class="verse">
          <div class="verse-he">
            <span class="word-he" data-link="words">דִּבְרֵי</span>
            <span class="placeholder" id="ph1">קֹהֶלֶת</span>
            <span class="word-he" data-link="son">בֶּן־דָּוִד</span>
            <span class="word-he" data-link="king">מֶלֶךְ</span>
            <span class="word-he" data-link="jerusalem">בִּירוּשָׁלָֽםִ</span>
          </div>
          <div class="verse-en">The <span class="word-en" data-link="words">words</span> of the <span class="word-en" data-link="teacher">Teacher</span>, <span class="word-en" data-link="son">son of David</span>, <span class="word-en" data-link="king">king</span> in <span class="word-en" data-link="jerusalem">Jerusalem</span></div>
        </div>
      </div>

      <!-- Slide 4: Verse 2 -->
      <div class="swiper-slide" data-verse="2">
        <div class="verse">
          <div class="verse-he">
            <span class="word-he" data-link="vanity">הֲבֵל</span>
            <span class="word-he" data-link="vanity">הֲבָלִים</span>
            <span class="word-he" data-link="says">אָמַר</span>
            <span class="placeholder" id="ph2">קֹהֶלֶת</span>
            <span class="word-he" data-link="vanity">הֲבֵל</span>
            <span class="word-he" data-link="vanity">הֲבָלִים</span>
            <span class="word-he" data-link="all">הַכֹּל</span>
            <span class="word-he" data-link="vanity">הָבֶל</span>
          </div>
          <div class="verse-en"><span class="word-en" data-link="vanity">Vanity</span> of <span class="word-en" data-link="vanity">vanities</span>, <span class="word-en" data-link="says">says</span> the <span class="word-en" data-link="teacher">Teacher</span>, <span class="word-en" data-link="vanity">vanity</span> of <span class="word-en" data-link="vanity">vanities</span>! <span class="word-en" data-link="all">All</span> is <span class="word-en" data-link="vanity">vanity</span>.</div>
        </div>
      </div>

      <!-- Slide 5: Verse 3 -->
      <div class="swiper-slide" data-verse="3">
        <div class="verse">
          <div class="verse-he">
            <span class="word-he" data-link="gain">מַה־יִּתְרוֹן</span>
            <span class="word-he" data-link="man">לָאָדָם</span>
            <span class="word-he" data-link="labor">בְּכָל־עֲמָלוֹ</span>
            <span class="word-he" data-link="toils">שֶׁיַּעֲמֹל</span>
            <span class="word-he" data-link="under">תַּחַת</span>
            <span class="word-he" data-link="sun">הַשָּׁמֶשׁ</span>
          </div>
          <div class="verse-en">What <span class="word-en" data-link="gain">gain</span> has <span class="word-en" data-link="man">man</span> from <span class="word-en" data-link="labor">all his toil</span> at which he <span class="word-en" data-link="toils">toils</span> <span class="word-en" data-link="under">under</span> the <span class="word-en" data-link="sun">sun</span>?</div>
        </div>
      </div>

      <!-- Slide 6: Verse 4 -->
      <div class="swiper-slide" data-verse="4">
        <div class="verse">
          <div class="verse-he">
            <span class="word-he" data-link="generation">דּוֹר</span>
            <span class="word-he" data-link="goes">הֹלֵךְ</span>
            <span class="word-he" data-link="generation">וְדוֹר</span>
            <span class="word-he" data-link="comes">בָּא</span>
            <span class="word-he" data-link="earth">וְהָאָרֶץ</span>
            <span class="word-he" data-link="forever">לְעוֹלָם</span>
            <span class="word-he" data-link="remains">עֹמָדֶת</span>
          </div>
          <div class="verse-en">A <span class="word-en" data-link="generation">generation</span> <span class="word-en" data-link="goes">goes</span>, and a <span class="word-en" data-link="generation">generation</span> <span class="word-en" data-link="comes">comes</span>, but the <span class="word-en" data-link="earth">earth</span> <span class="word-en" data-link="remains">remains</span> <span class="word-en" data-link="forever">forever</span>.</div>
        </div>
      </div>
    </div>
    <div class="swiper-pagination"></div>
  </div>

  <div class="title-he" id="qohelet" data-link="teacher">קֹהֶלֶת</div>

  <nav class="verse-nav" id="verseNav">
    <span data-slide="3">1:1</span>
    <span data-slide="4">1:2</span>
    <span data-slide="5">1:3</span>
    <span data-slide="6">1:4</span>
  </nav>

  <div class="scroll-hint" id="scrollHint">
    <span class="scroll-hint-text">Swipe to explore</span>
    <div class="scroll-hint-chevron"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <script>
    // ===== WORD DATA =====
    let wordData = {};

    // ===== ELEMENTS =====
    const qohelet = document.getElementById('qohelet');
    const verseNav = document.getElementById('verseNav');
    const scrollHint = document.getElementById('scrollHint');
    const ph1 = document.getElementById('ph1');
    const ph2 = document.getElementById('ph2');

    // ===== QOHELET CHOREOGRAPHY (the novel part) =====
    function getQoheletState(index) {
      const cx = window.innerWidth / 2;
      const cy = window.innerHeight / 2;

      const states = {
        0: { x: cx, y: cy + 70, scale: 1, opacity: 0 },
        1: { x: cx, y: cy + 40, scale: 1, opacity: 1 },
        2: { x: cx, y: cy, scale: 1, opacity: 1 },
        3: () => {
          const r = ph1.getBoundingClientRect();
          const scale = parseFloat(getComputedStyle(ph1).fontSize) / parseFloat(getComputedStyle(qohelet).fontSize);
          return { x: r.left + r.width / 2, y: r.top + r.height / 2, scale, opacity: 1 };
        },
        4: () => {
          const r = ph2.getBoundingClientRect();
          const scale = parseFloat(getComputedStyle(ph1).fontSize) / parseFloat(getComputedStyle(qohelet).fontSize);
          return { x: r.left + r.width / 2, y: r.top + r.height / 2, scale, opacity: 1 };
        }
      };

      // Slides 5+ (verse 3+): qohelet fades out
      if (index >= 5) return { x: states[4]().x, y: states[4]().y, scale: states[4]().scale, opacity: 0 };

      const state = states[index];
      return typeof state === 'function' ? state() : state;
    }

    function animateQohelet(index) {
      const state = getQoheletState(index);
      gsap.to(qohelet, {
        left: state.x,
        top: state.y,
        scale: state.scale,
        opacity: state.opacity,
        duration: 0.6,
        ease: 'power2.inOut',
        xPercent: -50,
        yPercent: -50
      });
    }

    // ===== SWIPER =====
    const swiper = new Swiper('.swiper', {
      direction: 'vertical',
      speed: 600,
      keyboard: { enabled: true },
      mousewheel: { sensitivity: 1 },
      pagination: {
        el: '.swiper-pagination',
        type: 'progressbar'
      },
      on: {
        slideChange: (s) => {
          animateQohelet(s.activeIndex);
          updateNav(s.activeIndex);
          if (s.activeIndex > 0) gsap.to(scrollHint, { opacity: 0, duration: 0.5 });
        },
        init: (s) => animateQohelet(0)
      }
    });

    // ===== VERSE NAV =====
    function updateNav(index) {
      verseNav.classList.toggle('visible', index >= 3);
      verseNav.querySelectorAll('span').forEach((el, i) => {
        el.classList.toggle('active', i + 3 === index);
      });
    }

    verseNav.addEventListener('click', e => {
      const slide = e.target.dataset.slide;
      if (slide) swiper.slideTo(parseInt(slide));
    });

    // ===== HIGHLIGHTING =====
    let litElements = [];
    function lightUp(link) {
      litElements.forEach(el => el.classList.remove('lit'));
      litElements = [...document.querySelectorAll(`[data-link="${link}"]`)];
      litElements.forEach(el => el.classList.add('lit'));
    }
    function clearLit() {
      litElements.forEach(el => el.classList.remove('lit'));
      litElements = [];
    }

    // ===== TIPPY TOOLTIPS =====
    async function initTooltips() {
      try {
        wordData = await fetch('./words.json').then(r => r.json());
      } catch (e) {
        console.warn('Could not load words.json');
        return;
      }

      tippy('[data-link]', {
        content: (el) => {
          const data = wordData[el.dataset.link];
          if (!data) return '';
          return `
            <div class="tooltip-hebrew">${data.hebrew}</div>
            <div class="tooltip-translit">${data.transliteration}</div>
            <div class="tooltip-tidbit">${data.tidbit}</div>
          `;
        },
        allowHTML: true,
        placement: (ref) => ref.classList.contains('word-en') ? 'bottom' : 'top',
        animation: 'scale',
        theme: 'ecclesiastes',
        interactive: true,
        appendTo: document.body,
        onShow: (instance) => lightUp(instance.reference.dataset.link),
        onHide: () => clearLit(),
        touch: ['hold', 300]
      });
    }

    // ===== INIT =====
    document.fonts.ready.then(initTooltips);
    window.addEventListener('resize', () => animateQohelet(swiper.activeIndex));
  </script>
</body>
</html>
